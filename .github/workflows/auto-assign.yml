name: Auto Assignment

on:
  issues:
    types: [opened, labeled]
  pull_request_target:
    types: [opened, labeled]

jobs:
  assign:
    runs-on: ubuntu-latest
    steps:
      - name: Assign Ops/Infra to Aegis
        if: |
          contains(github.event.issue.labels.*.name, 'ops') || 
          contains(github.event.issue.labels.*.name, 'deploy') ||
          contains(github.event.issue.labels.*.name, 'infrastructure') ||
          contains(github.event.pull_request.labels.*.name, 'ops') ||
          contains(github.event.pull_request.labels.*.name, 'deploy') ||
          contains(github.event.pull_request.labels.*.name, 'infrastructure')
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number || (context.payload.pull_request ? context.payload.pull_request.number : null);
            if (issue_number) {
              github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                assignees: ['aegis-molt']
              });
            }

      - name: Assign Testing to Captain Nemo
        if: |
          contains(github.event.issue.labels.*.name, 'test') || 
          contains(github.event.issue.labels.*.name, 'testing') ||
          contains(github.event.issue.labels.*.name, 'qa') ||
          contains(github.event.pull_request.labels.*.name, 'test') ||
          contains(github.event.pull_request.labels.*.name, 'testing') ||
          contains(github.event.pull_request.labels.*.name, 'qa')
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number || (context.payload.pull_request ? context.payload.pull_request.number : null);
            if (issue_number) {
              github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                assignees: ['captain-nemo-bot']
              });
            }

      - name: Assign Dev/Features to Stellar Chiron
        if: |
          contains(github.event.issue.labels.*.name, 'frontend') || 
          contains(github.event.issue.labels.*.name, 'backend') ||
          contains(github.event.issue.labels.*.name, 'feature') ||
          contains(github.event.pull_request.labels.*.name, 'frontend') ||
          contains(github.event.pull_request.labels.*.name, 'backend') ||
          contains(github.event.pull_request.labels.*.name, 'feature')
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number || (context.payload.pull_request ? context.payload.pull_request.number : null);
            if (issue_number) {
              github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                assignees: ['stellar-chiron']
              });
            }

      - name: Assign Docs and Reviews to Stellar Hogarthian
        if: |
          contains(github.event.issue.labels.*.name, 'documentation') || 
          contains(github.event.issue.labels.*.name, 'docs') ||
          contains(github.event.issue.labels.*.name, 'doc') ||
          contains(github.event.issue.labels.*.name, 'review') ||
          contains(github.event.pull_request.labels.*.name, 'documentation') ||
          contains(github.event.pull_request.labels.*.name, 'docs') ||
          contains(github.event.pull_request.labels.*.name, 'doc') ||
          contains(github.event.pull_request.labels.*.name, 'review')
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number || (context.payload.pull_request ? context.payload.pull_request.number : null);
            if (issue_number) {
              github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                assignees: ['Stellar-Hogarthian']
              });
            }

      - name: Request PR Review from Stellar Hogarthian
        if: github.event_name == 'pull_request' || github.event_name == 'pull_request_target'
        uses: actions/github-script@v7
        with:
          script: |
            if (context.payload.pull_request) {
              github.rest.pulls.requestReviewers({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: context.payload.pull_request.number,
                reviewers: ['Stellar-Hogarthian']
              });
            }
