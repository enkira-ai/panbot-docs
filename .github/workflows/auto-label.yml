name: Auto Labeler

on:
  issues:
    types: [opened, edited]
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  label:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - name: Auto Label based on Content
        uses: actions/github-script@v7
        with:
          script: |
            const payload = context.payload.issue || context.payload.pull_request;
            const body = (payload.body || "").toLowerCase();
            const title = (payload.title || "").toLowerCase();
            const content = title + " " + body;
            
            const labels = [];
            
            if (content.includes("feature") || content.includes("add")) labels.push("feature");
            if (content.includes("enhancement") || content.includes("improve")) labels.push("enhancement");
            if (content.includes("bug") || content.includes("fix") || content.includes("issue")) labels.push("bug");
            
            if (content.includes("frontend") || content.includes("ui") || content.includes("css")) labels.push("frontend");
            if (content.includes("backend") || content.includes("api") || content.includes("database") || content.includes("prisma")) labels.push("backend");
            
            if (content.includes("ops") || content.includes("deploy") || content.includes("ci/cd")) labels.push("ops");
            if (content.includes("k8s") || content.includes("kubernetes") || content.includes("helm")) labels.push("k8s");
            if (content.includes("docker") || content.includes("container") || content.includes("dockerfile")) labels.push("docker");
            
            if (content.includes("doc") || content.includes("documentation") || content.includes("readme")) labels.push("documentation");
            
            if (labels.length > 0) {
              const issue_number = context.issue.number || context.payload.pull_request.number;
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue_number,
                labels: labels
              });
            }
